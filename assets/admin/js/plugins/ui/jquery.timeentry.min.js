!function(e){function t(){this._disabledInputs=[],this.regional=[],this.regional[""]={show24Hours:!1,separator:":",ampmPrefix:"",ampmNames:["AM","PM"],spinnerTexts:["Now","Previous field","Next field","Increment","Decrement"]},this._defaults={appendText:"",showSeconds:!1,timeSteps:[1,1,1],initialField:0,useMouseWheel:!0,defaultTime:null,minTime:null,maxTime:null,spinnerImage:"spinnerDefault.png",spinnerSize:[20,20,8],spinnerBigImage:"",spinnerBigSize:[40,40,16],spinnerIncDecOnly:!1,spinnerRepeat:[500,250],beforeShow:null,beforeSetTime:null},e.extend(this._defaults,this.regional[""])}function n(t,n){e.extend(t,n);for(var i in n)null==n[i]&&(t[i]=null);return t}var i="timeEntry";e.extend(t.prototype,{markerClassName:"hasTimeEntry",setDefaults:function(e){return n(this._defaults,e||{}),this},_connectTimeEntry:function(t,n){var r=e(t);if(!r.hasClass(this.markerClassName)){var s={};s.options=e.extend({},n),s._selectedHour=0,s._selectedMinute=0,s._selectedSecond=0,s._field=0,s.input=e(t),e.data(t,i,s);var a=this._get(s,"spinnerImage"),o=(this._get(s,"spinnerText"),this._get(s,"spinnerSize")),l=this._get(s,"appendText"),m=a?e('<span class="timeEntry_control" style="display: inline-block; background: url(\''+a+"') 0 0 no-repeat; width: "+o[0]+"px; height: "+o[1]+"px;"+(e.browser.mozilla&&e.browser.version<"1.9"?" padding-left: "+o[0]+"px; padding-bottom: "+(o[1]-18)+"px;":"")+'"></span>'):null;r.wrap('<span class="timeEntry_wrap"></span>').after(l?'<span class="timeEntry_append">'+l+"</span>":"").after(m||""),r.addClass(this.markerClassName).bind("focus.timeEntry",this._doFocus).bind("blur.timeEntry",this._doBlur).bind("click.timeEntry",this._doClick).bind("keydown.timeEntry",this._doKeyDown).bind("keypress.timeEntry",this._doKeyPress),e.browser.mozilla&&r.bind("input.timeEntry",function(t){e.timeEntry._parseTime(s)}),e.browser.msie&&r.bind("paste.timeEntry",function(t){setTimeout(function(){e.timeEntry._parseTime(s)},1)}),this._get(s,"useMouseWheel")&&e.fn.mousewheel&&r.mousewheel(this._doMouseWheel),m&&m.mousedown(this._handleSpinner).mouseup(this._endSpinner).mouseover(this._expandSpinner).mouseout(this._endSpinner).mousemove(this._describeSpinner)}},_enableTimeEntry:function(e){this._enableDisable(e,!1)},_disableTimeEntry:function(e){this._enableDisable(e,!0)},_enableDisable:function(t,n){var r=e.data(t,i);r&&(t.disabled=n,t.nextSibling&&"span"==t.nextSibling.nodeName.toLowerCase()&&e.timeEntry._changeSpinner(r,t.nextSibling,n?5:-1),e.timeEntry._disabledInputs=e.map(e.timeEntry._disabledInputs,function(e){return e==t?null:e}),n&&e.timeEntry._disabledInputs.push(t))},_isDisabledTimeEntry:function(t){return e.inArray(t,this._disabledInputs)>-1},_changeTimeEntry:function(t,r,s){var a=e.data(t,i);if(a){if("string"==typeof r){var o=r;r={},r[o]=s}var l=this._extractTime(a);n(a.options,r||{}),l&&this._setTime(a,new Date(0,0,0,l[0],l[1],l[2]))}e.data(t,i,a)},_destroyTimeEntry:function(t){$input=e(t),$input.hasClass(this.markerClassName)&&($input.removeClass(this.markerClassName).unbind(".timeEntry"),e.fn.mousewheel&&$input.unmousewheel(),this._disabledInputs=e.map(this._disabledInputs,function(e){return e==t?null:e}),$input.parent().replaceWith($input),e.removeData(t,i))},_setTimeTimeEntry:function(t,n){var r=e.data(t,i);r&&(null===n||""===n?r.input.val(""):this._setTime(r,n?"object"==typeof n?new Date(n.getTime()):n:null))},_getTimeTimeEntry:function(t){var n=e.data(t,i),r=n?this._extractTime(n):null;return r?new Date(0,0,0,r[0],r[1],r[2]):null},_getOffsetTimeEntry:function(t){var n=e.data(t,i),r=n?this._extractTime(n):null;return r?1e3*(3600*r[0]+60*r[1]+r[2]):0},_doFocus:function(t){var r=t.nodeName&&"input"==t.nodeName.toLowerCase()?t:this;if(e.timeEntry._lastInput==r||e.timeEntry._isDisabledTimeEntry(r))return void(e.timeEntry._focussed=!1);var s=e.data(r,i);e.timeEntry._focussed=!0,e.timeEntry._lastInput=r,e.timeEntry._blurredInput=null;var a=e.timeEntry._get(s,"beforeShow");n(s.options,a?a.apply(r,[r]):{}),e.data(r,i,s),e.timeEntry._parseTime(s),setTimeout(function(){e.timeEntry._showField(s)},10)},_doBlur:function(t){e.timeEntry._blurredInput=e.timeEntry._lastInput,e.timeEntry._lastInput=null},_doClick:function(t){var n=t.target,r=e.data(n,i);if(!e.timeEntry._focussed){var s=e.timeEntry._get(r,"separator").length+2;if(r._field=0,null!=n.selectionStart)for(var a=0;a<=Math.max(1,r._secondField,r._ampmField);a++){var o=a!=r._ampmField?a*s+2:r._ampmField*s+e.timeEntry._get(r,"ampmPrefix").length+e.timeEntry._get(r,"ampmNames")[0].length;if(r._field=a,n.selectionStart<o)break}else if(n.createTextRange)for(var l=e(t.srcElement),m=n.createTextRange(),u=function(e){return{thin:2,medium:4,thick:6}[e]||e},_=t.clientX+document.documentElement.scrollLeft-(l.offset().left+parseInt(u(l.css("border-left-width")),10))-m.offsetLeft,a=0;a<=Math.max(1,r._secondField,r._ampmField);a++){var o=a!=r._ampmField?a*s+2:r._ampmField*s+e.timeEntry._get(r,"ampmPrefix").length+e.timeEntry._get(r,"ampmNames")[0].length;if(m.collapse(),m.moveEnd("character",o),r._field=a,_<m.boundingWidth)break}}e.data(n,i,r),e.timeEntry._showField(r),e.timeEntry._focussed=!1},_doKeyDown:function(t){if(t.keyCode>=48)return!0;var n=e.data(t.target,i);switch(t.keyCode){case 9:return t.shiftKey?e.timeEntry._changeField(n,-1,!0):e.timeEntry._changeField(n,1,!0);case 35:t.ctrlKey?e.timeEntry._setValue(n,""):(n._field=Math.max(1,n._secondField,n._ampmField),e.timeEntry._adjustField(n,0));break;case 36:t.ctrlKey?e.timeEntry._setTime(n):(n._field=0,e.timeEntry._adjustField(n,0));break;case 37:e.timeEntry._changeField(n,-1,!1);break;case 38:e.timeEntry._adjustField(n,1);break;case 39:e.timeEntry._changeField(n,1,!1);break;case 40:e.timeEntry._adjustField(n,-1);break;case 46:e.timeEntry._setValue(n,"")}return!1},_doKeyPress:function(t){var n=String.fromCharCode(void 0==t.charCode?t.keyCode:t.charCode);if(" ">n)return!0;var r=e.data(t.target,i);return e.timeEntry._handleKeyPress(r,n),!1},_doMouseWheel:function(t,n){if(!e.timeEntry._isDisabledTimeEntry(t.target)){n=e.browser.opera?-n/Math.abs(n):e.browser.safari?n/Math.abs(n):n;var r=e.data(t.target,i);r.input.focus(),r.input.val()||e.timeEntry._parseTime(r),e.timeEntry._adjustField(r,n),t.preventDefault()}},_expandSpinner:function(t){var n=e.timeEntry._getSpinnerTarget(t),r=e.data(e.timeEntry._getInput(n),i);if(!e.timeEntry._isDisabledTimeEntry(r.input[0])){var s=e.timeEntry._get(r,"spinnerBigImage");if(s){r._expanded=!0;var a=e(n).offset(),o=null;e(n).parents().each(function(){var t=e(this);return("relative"==t.css("position")||"absolute"==t.css("position"))&&(o=t.offset()),!o});var l=e.timeEntry._get(r,"spinnerSize"),m=e.timeEntry._get(r,"spinnerBigSize");e('<div class="timeEntry_expand" style="position: absolute; left: '+(a.left-(m[0]-l[0])/2-(o?o.left:0))+"px; top: "+(a.top-(m[1]-l[1])/2-(o?o.top:0))+"px; width: "+m[0]+"px; height: "+m[1]+"px; background: transparent url("+s+') no-repeat 0px 0px; z-index: 10;"></div>').mousedown(e.timeEntry._handleSpinner).mouseup(e.timeEntry._endSpinner).mouseout(e.timeEntry._endExpand).mousemove(e.timeEntry._describeSpinner).insertAfter(n)}}},_getInput:function(t){return e(t).siblings("."+e.timeEntry.markerClassName)[0]},_describeSpinner:function(t){var n=e.timeEntry._getSpinnerTarget(t),r=e.data(e.timeEntry._getInput(n),i);n.title=e.timeEntry._get(r,"spinnerTexts")[e.timeEntry._getSpinnerRegion(r,t)]},_handleSpinner:function(t){var n=e.timeEntry._getSpinnerTarget(t),r=e.timeEntry._getInput(n);if(!e.timeEntry._isDisabledTimeEntry(r)){r==e.timeEntry._blurredInput&&(e.timeEntry._lastInput=r,e.timeEntry._blurredInput=null);var s=e.data(r,i);e.timeEntry._doFocus(r);var a=e.timeEntry._getSpinnerRegion(s,t);e.timeEntry._changeSpinner(s,n,a),e.timeEntry._actionSpinner(s,a),e.timeEntry._timer=null,e.timeEntry._handlingSpinner=!0;var o=e.timeEntry._get(s,"spinnerRepeat");a>=3&&o[0]&&(e.timeEntry._timer=setTimeout(function(){e.timeEntry._repeatSpinner(s,a)},o[0]),e(n).one("mouseout",e.timeEntry._releaseSpinner).one("mouseup",e.timeEntry._releaseSpinner))}},_actionSpinner:function(t,n){switch(t.input.val()||e.timeEntry._parseTime(t),n){case 0:this._setTime(t);break;case 1:this._changeField(t,-1,!1);break;case 2:this._changeField(t,1,!1);break;case 3:this._adjustField(t,1);break;case 4:this._adjustField(t,-1)}},_repeatSpinner:function(t,n){e.timeEntry._timer&&(e.timeEntry._lastInput=e.timeEntry._blurredInput,this._actionSpinner(t,n),this._timer=setTimeout(function(){e.timeEntry._repeatSpinner(t,n)},this._get(t,"spinnerRepeat")[1]))},_releaseSpinner:function(t){clearTimeout(e.timeEntry._timer),e.timeEntry._timer=null},_endExpand:function(t){e.timeEntry._timer=null;var n=e.timeEntry._getSpinnerTarget(t),r=e.timeEntry._getInput(n),s=e.data(r,i);e(n).remove(),s._expanded=!1},_endSpinner:function(t){e.timeEntry._timer=null;var n=e.timeEntry._getSpinnerTarget(t),r=e.timeEntry._getInput(n),s=e.data(r,i);e.timeEntry._isDisabledTimeEntry(r)||e.timeEntry._changeSpinner(s,n,-1),e.timeEntry._handlingSpinner&&(e.timeEntry._lastInput=e.timeEntry._blurredInput),e.timeEntry._lastInput&&e.timeEntry._handlingSpinner&&e.timeEntry._showField(s),e.timeEntry._handlingSpinner=!1},_getSpinnerTarget:function(e){return e.target||e.srcElement},_getSpinnerRegion:function(t,n){var i=this._getSpinnerTarget(n),r=e.browser.opera||e.browser.safari?e.timeEntry._findPos(i):e(i).offset(),s=e.browser.safari?e.timeEntry._findScroll(i):[document.documentElement.scrollLeft||document.body.scrollLeft,document.documentElement.scrollTop||document.body.scrollTop],a=this._get(t,"spinnerIncDecOnly"),o=a?99:n.clientX+s[0]-r.left-(e.browser.msie?2:0),l=n.clientY+s[1]-r.top-(e.browser.msie?2:0),m=this._get(t,t._expanded?"spinnerBigSize":"spinnerSize"),u=a?99:m[0]-1-o,_=m[1]-1-l;if(m[2]>0&&Math.abs(o-u)<=m[2]&&Math.abs(l-_)<=m[2])return 0;var d=Math.min(o,l,u,_);return d==o?1:d==u?2:d==l?3:4},_changeSpinner:function(t,n,i){e(n).css("","-"+(i+1)*this._get(t,t._expanded?"spinnerBigSize":"spinnerSize")[0]+"px 0px")},_findPos:function(e){var t=curTop=0;if(e.offsetParent)for(t=e.offsetLeft,curTop=e.offsetTop;e=e.offsetParent;){var n=t;t+=e.offsetLeft,0>t&&(t=n),curTop+=e.offsetTop}return{left:t,top:curTop}},_findScroll:function(t){var n=!1;if(e(t).parents().each(function(){n|="fixed"==e(this).css("position")}),n)return[0,0];for(var i=t.scrollLeft,r=t.scrollTop;t=t.parentNode;)i+=t.scrollLeft||0,r+=t.scrollTop||0;return[i,r]},_get:function(t,n){return null!=t.options[n]?t.options[n]:e.timeEntry._defaults[n]},_parseTime:function(e){var t=this._extractTime(e),n=this._get(e,"showSeconds");if(t)e._selectedHour=t[0],e._selectedMinute=t[1],e._selectedSecond=t[2];else{var i=this._constrainTime(e);e._selectedHour=i[0],e._selectedMinute=i[1],e._selectedSecond=n?i[2]:0}e._secondField=n?2:-1,e._ampmField=this._get(e,"show24Hours")?-1:n?3:2,e._lastChr="",e._field=Math.max(0,Math.min(Math.max(1,e._secondField,e._ampmField),this._get(e,"initialField"))),""!=e.input.val()&&this._showTime(e)},_extractTime:function(e,t){t=t||e.input.val();var n=this._get(e,"separator"),i=t.split(n);""==n&&""!=t&&(i[0]=t.substring(0,2),i[1]=t.substring(2,4),i[2]=t.substring(4,6));var r=this._get(e,"ampmNames"),s=this._get(e,"show24Hours");if(i.length>=2){var a=!s&&t.indexOf(r[0])>-1,o=!s&&t.indexOf(r[1])>-1,l=parseInt(i[0],10);l=isNaN(l)?0:l,l=((a||o)&&12==l?0:l)+(o?12:0);var m=parseInt(i[1],10);m=isNaN(m)?0:m;var u=i.length>=3?parseInt(i[2],10):0;return u=isNaN(u)||!this._get(e,"showSeconds")?0:u,this._constrainTime(e,[l,m,u])}return null},_constrainTime:function(e,t){var n=null!=t;if(!n){var i=this._determineTime(e,this._get(e,"defaultTime"))||new Date;t=[i.getHours(),i.getMinutes(),i.getSeconds()]}for(var r=!1,s=this._get(e,"timeSteps"),a=0;a<s.length;a++)r?t[a]=0:s[a]>1&&(t[a]=Math.round(t[a]/s[a])*s[a],r=!0);return t},_showTime:function(e){var t=this._get(e,"show24Hours"),n=this._get(e,"separator"),i=this._formatNumber(t?e._selectedHour:(e._selectedHour+11)%12+1)+n+this._formatNumber(e._selectedMinute)+(this._get(e,"showSeconds")?n+this._formatNumber(e._selectedSecond):"")+(t?"":this._get(e,"ampmPrefix")+this._get(e,"ampmNames")[e._selectedHour<12?0:1]);this._setValue(e,i),this._showField(e)},_showField:function(t){var n=t.input[0];if(!t.input.is(":hidden")&&e.timeEntry._lastInput==n){var i=this._get(t,"separator"),r=i.length+2,s=t._field!=t._ampmField?t._field*r:t._ampmField*r-i.length+this._get(t,"ampmPrefix").length,a=s+(t._field!=t._ampmField?2:this._get(t,"ampmNames")[0].length);if(n.setSelectionRange)n.setSelectionRange(s,a);else if(n.createTextRange){var o=n.createTextRange();o.moveStart("character",s),o.moveEnd("character",a-t.input.val().length),o.select()}n.disabled||n.focus()}},_formatNumber:function(e){return(10>e?"0":"")+e},_setValue:function(e,t){t!=e.input.val()&&e.input.val(t).trigger("change")},_changeField:function(t,n,r){var s=""==t.input.val()||t._field==(-1==n?0:Math.max(1,t._secondField,t._ampmField));return s||(t._field+=n),this._showField(t),t._lastChr="",e.data(t.input[0],i,t),s&&r},_adjustField:function(e,t){""==e.input.val()&&(t=0);var n=this._get(e,"timeSteps");this._setTime(e,new Date(0,0,0,e._selectedHour+(0==e._field?t*n[0]:0)+(e._field==e._ampmField?12*t:0),e._selectedMinute+(1==e._field?t*n[1]:0),e._selectedSecond+(e._field==e._secondField?t*n[2]:0)))},_setTime:function(t,n){n=this._determineTime(t,n);var r=this._constrainTime(t,n?[n.getHours(),n.getMinutes(),n.getSeconds()]:null);n=new Date(0,0,0,r[0],r[1],r[2]);var n=this._normaliseTime(n),s=this._normaliseTime(this._determineTime(t,this._get(t,"minTime"))),a=this._normaliseTime(this._determineTime(t,this._get(t,"maxTime")));n=s&&s>n?s:a&&n>a?a:n;var o=this._get(t,"beforeSetTime");o&&(n=o.apply(t.input[0],[this._getTimeTimeEntry(t.input[0]),n,s,a])),t._selectedHour=n.getHours(),t._selectedMinute=n.getMinutes(),t._selectedSecond=n.getSeconds(),this._showTime(t),e.data(t.input[0],i,t)},_normaliseTime:function(e){return e?(e.setFullYear(1900),e.setMonth(0),e.setDate(0),e):null},_determineTime:function(t,n){var i=function(e){var t=new Date;return t.setTime(t.getTime()+1e3*e),t},r=function(n){var i=e.timeEntry._extractTime(t,n),r=new Date,s=i?i[0]:r.getHours(),a=i?i[1]:r.getMinutes(),o=i?i[2]:r.getSeconds();if(!i)for(var l=/([+-]?[0-9]+)\s*(s|S|m|M|h|H)?/g,m=l.exec(n);m;){switch(m[2]||"s"){case"s":case"S":o+=parseInt(m[1],10);break;case"m":case"M":a+=parseInt(m[1],10);break;case"h":case"H":s+=parseInt(m[1],10)}m=l.exec(n)}return r=new Date(0,0,10,s,a,o,0),/^!/.test(n)&&(r.getDate()>10?r=new Date(0,0,10,23,59,59):r.getDate()<10&&(r=new Date(0,0,10,0,0,0))),r};return n?"string"==typeof n?r(n):"number"==typeof n?i(n):n:null},_handleKeyPress:function(e,t){if(t==this._get(e,"separator"))this._changeField(e,1,!1);else if(t>="0"&&"9">=t){var n=parseInt(t,10),i=parseInt(e._lastChr+t,10),r=this._get(e,"show24Hours"),s=0!=e._field?e._selectedHour:r?24>i?i:n:(i>=1&&12>=i?i:n>0?n:e._selectedHour)%12+(e._selectedHour>=12?12:0),a=1!=e._field?e._selectedMinute:60>i?i:n,o=e._field!=e._secondField?e._selectedSecond:60>i?i:n,l=this._constrainTime(e,[s,a,o]);this._setTime(e,new Date(0,0,0,l[0],l[1],l[2])),e._lastChr=t}else if(!this._get(e,"show24Hours")){t=t.toLowerCase();var m=this._get(e,"ampmNames");if(t==m[0].substring(0,1).toLowerCase()&&e._selectedHour>=12||t==m[1].substring(0,1).toLowerCase()&&e._selectedHour<12){var u=e._field;e._field=e._ampmField,this._adjustField(e,1),e._field=u,this._showField(e)}}}});var r=["getOffset","getTime","isDisabled"];e.fn.timeEntry=function(t){var n=Array.prototype.slice.call(arguments,1);return"string"==typeof t&&e.inArray(t,r)>-1?e.timeEntry["_"+t+"TimeEntry"].apply(e.timeEntry,[this[0]].concat(n)):this.each(function(){var i=this.nodeName.toLowerCase();if("input"==i)if("string"==typeof t)e.timeEntry["_"+t+"TimeEntry"].apply(e.timeEntry,[this].concat(n));else{var r=e.fn.metadata?e(this).metadata():{};e.timeEntry._connectTimeEntry(this,e.extend(r,t))}})},e.timeEntry=new t}(jQuery);
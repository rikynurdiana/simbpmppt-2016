!function(e){function t(t){function a(e,t){t.series.pie.show&&(t.grid.show=!1,"auto"==t.series.pie.label.show&&(t.legend.show?t.series.pie.label.show=!1:t.series.pie.label.show=!0),"auto"==t.series.pie.radius&&(t.series.pie.label.show?t.series.pie.radius=.75:t.series.pie.radius=1),t.series.pie.tilt>1&&(t.series.pie.tilt=1),t.series.pie.tilt<0&&(t.series.pie.tilt=0),e.hooks.processDatapoints.push(n),e.hooks.drawOverlay.push(k),e.hooks.draw.push(d))}function r(e,t){var i=e.getOptions();i.series.pie.show&&i.grid.hoverable&&t.unbind("mousemove").mousemove(f),i.series.pie.show&&i.grid.clickable&&t.unbind("click").click(v)}function l(e){for(var t=0;t<e.length;++t){var i=parseFloat(e[t].data[0][1]);i&&(R+=i)}}function n(t,i,a,r){D||(D=!0,m=t.getCanvas(),A=e(m).parent(),s=t.getOptions(),t.setData(c(t.getData())))}function o(){F=A.children().filter(".legend").children().width(),I=Math.min(m.width,m.height/s.series.pie.tilt)/2,Y=m.height/2+s.series.pie.offset.top,X=m.width/2,"auto"==s.series.pie.offset.left?s.legend.position.match("w")?X+=F/2:X-=F/2:X+=s.series.pie.offset.left,I>X?X=I:X>m.width-I&&(X=m.width-I)}function p(e){for(var t=0;t<e.length;++t)"number"==typeof e[t].data?e[t].data=[[1,e[t].data]]:("undefined"==typeof e[t].data||"undefined"==typeof e[t].data[0])&&("undefined"!=typeof e[t].data&&"undefined"!=typeof e[t].data.label&&(e[t].label=e[t].data.label),e[t].data=[[1,0]]);return e}function c(e){e=p(e),l(e);for(var t=0,i=0,a=s.series.pie.combine.color,r=[],n=0;n<e.length;++n)e[n].data[0][1]=parseFloat(e[n].data[0][1]),e[n].data[0][1]||(e[n].data[0][1]=0),e[n].data[0][1]/R<=s.series.pie.combine.threshold?(t+=e[n].data[0][1],i++,a||(a=e[n].color)):r.push({data:[[1,e[n].data[0][1]]],color:e[n].color,label:e[n].label,angle:e[n].data[0][1]*(2*Math.PI)/R,percent:e[n].data[0][1]/R*100});return i>0&&r.push({data:[[1,t]],color:a,label:s.series.pie.combine.label,angle:t*(2*Math.PI)/R,percent:t/R*100}),r}function d(t,i){function a(){ctx.clearRect(0,0,m.width,m.height),A.children().filter(".pieLabel, .pieLabelBackground").remove()}function r(){var e=5,t=15,i=10,a=.02;if(s.series.pie.radius>1)var r=s.series.pie.radius;else var r=I*s.series.pie.radius;if(!(r>=m.width/2-e||r*s.series.pie.tilt>=m.height/2-t||i>=r)){ctx.save(),ctx.translate(e,t),ctx.globalAlpha=a,ctx.fillStyle="#000",ctx.translate(X,Y),ctx.scale(1,s.series.pie.tilt);for(var l=1;i>=l;l++)ctx.beginPath(),ctx.arc(0,0,r,0,2*Math.PI,!1),ctx.fill(),r-=l;ctx.restore()}}function l(){function t(t,i,s){0>=t||(s?ctx.fillStyle=i:(ctx.strokeStyle=i,ctx.lineJoin="round"),ctx.beginPath(),Math.abs(t-2*Math.PI)>1e-9?ctx.moveTo(0,0):e.browser.msie&&(t-=1e-4),ctx.arc(0,0,a,r,r+t,!1),ctx.closePath(),r+=t,s?ctx.fill():ctx.stroke())}function i(){function t(t,i,r){if(0!=t.data[0][1]){var l,n=s.legend.labelFormatter,o=s.series.pie.label.formatter;l=n?n(t.label,t):t.label,o&&(l=o(l,t));var p=(i+t.angle+i)/2,c=X+Math.round(Math.cos(p)*a),d=Y+Math.round(Math.sin(p)*a)*s.series.pie.tilt,h='<span class="pieLabel" id="pieLabel'+r+'" style="position:absolute;top:'+d+"px;left:"+c+'px;">'+l+"</span>";A.append(h);var u=A.children("#pieLabel"+r),g=d-u.height()/2,f=c-u.width()/2;if(u.css("top",g),u.css("left",f),(0-g>0||0-f>0||m.height-(g+u.height())<0||m.width-(f+u.width())<0)&&(O=!0),0!=s.series.pie.label.background.opacity){var v=s.series.pie.label.background.color;null==v&&(v=t.color);var b="top:"+g+"px;left:"+f+"px;";e('<div class="pieLabelBackground" style="position:absolute;width:'+u.width()+"px;height:"+u.height()+"px;"+b+"background-color:"+v+';"> </div>').insertBefore(u).css("opacity",s.series.pie.label.background.opacity)}}}var i=startAngle;if(s.series.pie.label.radius>1)var a=s.series.pie.label.radius;else var a=I*s.series.pie.label.radius;for(var r=0;r<n.length;++r)n[r].percent>=100*s.series.pie.label.threshold&&t(n[r],i,r),i+=n[r].angle}if(startAngle=Math.PI*s.series.pie.startAngle,s.series.pie.radius>1)var a=s.series.pie.radius;else var a=I*s.series.pie.radius;ctx.save(),ctx.translate(X,Y),ctx.scale(1,s.series.pie.tilt),ctx.save();for(var r=startAngle,l=0;l<n.length;++l)n[l].startAngle=r,t(n[l].angle,n[l].color,!0);ctx.restore(),ctx.save(),ctx.lineWidth=s.series.pie.stroke.width,r=startAngle;for(var l=0;l<n.length;++l)t(n[l].angle,s.series.pie.stroke.color,!1);ctx.restore(),h(ctx),s.series.pie.label.show&&i(),ctx.restore()}if(A){ctx=i,o();for(var n=t.getData(),p=0;O&&L>p;)O=!1,p>0&&(I*=S),p+=1,a(),s.series.pie.tilt<=.8&&r(),l();p>=L&&(a(),A.prepend('<div class="error">Could not draw pie with labels contained inside canvas</div>')),t.setSeries&&t.insertLegend&&(t.setSeries(n),t.insertLegend())}}function h(e){s.series.pie.innerRadius>0&&(e.save(),innerRadius=s.series.pie.innerRadius>1?s.series.pie.innerRadius:I*s.series.pie.innerRadius,e.globalCompositeOperation="destination-out",e.beginPath(),e.fillStyle=s.series.pie.stroke.color,e.arc(0,0,innerRadius,0,2*Math.PI,!1),e.fill(),e.closePath(),e.restore(),e.save(),e.beginPath(),e.strokeStyle=s.series.pie.stroke.color,e.arc(0,0,innerRadius,0,2*Math.PI,!1),e.stroke(),e.closePath(),e.restore())}function u(e,t){for(var i=!1,s=-1,a=e.length,r=a-1;++s<a;r=s)(e[s][1]<=t[1]&&t[1]<e[r][1]||e[r][1]<=t[1]&&t[1]<e[s][1])&&t[0]<(e[r][0]-e[s][0])*(t[1]-e[s][1])/(e[r][1]-e[s][1])+e[s][0]&&(i=!i);return i}function g(e,i){for(var s=t.getData(),a=t.getOptions(),r=a.series.pie.radius>1?a.series.pie.radius:I*a.series.pie.radius,l=0;l<s.length;++l){var n=s[l];if(n.pie.show){if(ctx.save(),ctx.beginPath(),ctx.moveTo(0,0),ctx.arc(0,0,r,n.startAngle,n.startAngle+n.angle,!1),ctx.closePath(),x=e-X,y=i-Y,ctx.isPointInPath){if(ctx.isPointInPath(e-X,i-Y))return ctx.restore(),{datapoint:[n.percent,n.data],dataIndex:0,series:n,seriesIndex:l}}else if(p1X=r*Math.cos(n.startAngle),p1Y=r*Math.sin(n.startAngle),p2X=r*Math.cos(n.startAngle+n.angle/4),p2Y=r*Math.sin(n.startAngle+n.angle/4),p3X=r*Math.cos(n.startAngle+n.angle/2),p3Y=r*Math.sin(n.startAngle+n.angle/2),p4X=r*Math.cos(n.startAngle+n.angle/1.5),p4Y=r*Math.sin(n.startAngle+n.angle/1.5),p5X=r*Math.cos(n.startAngle+n.angle),p5Y=r*Math.sin(n.startAngle+n.angle),arrPoly=[[0,0],[p1X,p1Y],[p2X,p2Y],[p3X,p3Y],[p4X,p4Y],[p5X,p5Y]],arrPoint=[x,y],u(arrPoly,arrPoint))return ctx.restore(),{datapoint:[n.percent,n.data],dataIndex:0,series:n,seriesIndex:l};ctx.restore()}}return null}function f(e){b("plothover",e)}function v(e){b("plotclick",e)}function b(e,i){var a=t.offset(),r=parseInt(i.pageX-a.left),l=parseInt(i.pageY-a.top),n=g(r,l);if(s.grid.autoHighlight)for(var o=0;o<B.length;++o){var p=B[o];p.auto!=e||n&&p.series==n.series||P(p.series)}n&&w(n.series,e);var c={pageX:i.pageX,pageY:i.pageY};A.trigger(e,[c,n])}function w(e,i){"number"==typeof e&&(e=series[e]);var s=M(e);-1==s?(B.push({series:e,auto:i}),t.triggerRedrawOverlay()):i||(B[s].auto=!1)}function P(e){null==e&&(B=[],t.triggerRedrawOverlay()),"number"==typeof e&&(e=series[e]);var i=M(e);-1!=i&&(B.splice(i,1),t.triggerRedrawOverlay())}function M(e){for(var t=0;t<B.length;++t){var i=B[t];if(i.series==e)return t}return-1}function k(e,t){function s(e){e.angle<0||(t.fillStyle="rgba(255, 255, 255, "+a.series.pie.highlight.opacity+")",t.beginPath(),Math.abs(e.angle-2*Math.PI)>1e-9&&t.moveTo(0,0),t.arc(0,0,r,e.startAngle,e.startAngle+e.angle,!1),t.closePath(),t.fill())}var a=e.getOptions(),r=a.series.pie.radius>1?a.series.pie.radius:I*a.series.pie.radius;for(t.save(),t.translate(X,Y),t.scale(1,a.series.pie.tilt),i=0;i<B.length;++i)s(B[i].series);h(t),t.restore()}var m=null,A=null,I=null,X=null,Y=null,R=0,O=!0,L=10,S=.95,F=0,D=!1,B=[];t.hooks.processOptions.push(a),t.hooks.bindEvents.push(r)}var s={series:{pie:{show:!1,radius:"auto",innerRadius:0,startAngle:1.5,tilt:1,offset:{top:0,left:"auto"},stroke:{color:"#FFF",width:1},label:{show:"auto",formatter:function(e,t){return'<div style="font-size:x-small;text-align:center;padding:2px;color:'+t.color+';">'+e+"<br/>"+Math.round(t.percent)+"%</div>"},radius:1,background:{color:null,opacity:0},threshold:0},combine:{threshold:-1,color:null,label:"Other"},highlight:{opacity:.1}}}};e.plot.plugins.push({init:t,options:s,name:"pie",version:"1.0"})}(jQuery);